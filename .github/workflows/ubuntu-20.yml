on:
  workflow_dispatch:
  push:
    paths:
      - Dockerfile.ubuntu20
      - .github/workflows/ubuntu-20.yml
      - .github/workflows/build.yml

jobs:
  cu117:
    uses: ./.github/workflows/build.yml
    with:
      folder: .
      dockerfile: Dockerfile.ubuntu20
      base-image: nvidia/cuda
      base-tag: 11.7.1-cudnn8-devel-ubuntu20.04
      cuda-version-minor: "11.7.1"
      cuda-version-major: "11.7"
      nccl-version: 2.14.3-1
      cuda-samples-version: "11.6"
      hpcx-version: "2.14"
      hpcx-nccl-version: "2.16"
      hpcx-cuda-version: "11"

  cu118:
    uses: ./.github/workflows/build.yml
    with:
      folder: .
      dockerfile: Dockerfile.ubuntu20
      base-image: nvidia/cuda
      base-tag: 11.8.0-cudnn8-devel-ubuntu20.04
      cuda-version-minor: "11.8.0"
      cuda-version-major: "11.8"
      nccl-version: 2.16.2-1
      cuda-samples-version: "11.6"
      hpcx-version: "2.14"
      hpcx-nccl-version: "2.16"
      hpcx-cuda-version: "11"

  cu120:
    uses: ./.github/workflows/build.yml
    with:
      folder: .
      dockerfile: Dockerfile.ubuntu20
      base-image: nvidia/cuda
      base-tag: 12.0.1-cudnn8-devel-ubuntu20.04
      cuda-version-minor: "12.0.1"
      cuda-version-major: "12.0"
      nccl-version: 2.18.3-1
      cuda-samples-version: "12.0"
      hpcx-version: "2.15"
      hpcx-nccl-version: "2.17"
      hpcx-cuda-version: "12"

  cu121:
    uses: ./.github/workflows/build.yml
    with:
      folder: .
      dockerfile: Dockerfile.ubuntu20
      base-image: nvidia/cuda
      base-tag: 12.1.1-cudnn8-devel-ubuntu20.04
      cuda-version-minor: "12.1.1"
      cuda-version-major: "12.1"
      nccl-version: 2.18.3-1
      cuda-samples-version: "12.1"
      hpcx-version: "2.15"
      hpcx-nccl-version: "2.17"
      hpcx-cuda-version: "12"
